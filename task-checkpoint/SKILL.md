---
name: task-checkpoint
description: 通过自然语言执行 GitHub Issue 的任务与日志双模式：创建任务、记录检查点、恢复上下文、终止任务，以及按主题生成会话存档日志。适用于无法切换终端、需要代理代执行 gh 命令并沉淀工作上下文的场景。关键词：检查点、恢复、日志、存档、issue。
---

# 任务检查点

## 目标

- 面向“无法切出终端执行命令”的场景，用自然语言驱动 `gh issue`。
- 同时支持两类对象：
  - **任务（Task）**：可推进、可中断、可恢复的工作项。
  - **日志（Log）**：一次会话/探索的归档记录（按主题与结论沉淀）。

## 操作说明

1. **先识别模式（任务 / 日志）**
   - 任务触发词：`新建任务` `记录检查点` `恢复` `终止` `完成`
   - 日志触发词：`存档` `汇总` `记录这次对话` `生成日志`

2. **默认仓库与命名策略**
   - 默认仓库：`qiao-925/qiao-925`
   - 标题自动规则：
     - 任务：`[GEN][Tn] <目标短句>`
     - 日志：`[LOG][GEN] <主题短句> (<YYYY-MM-DD>)`

3. **任务模式命令**
   - 新建：`gh tnew "[GEN][T1] 标题" "目标...\n恢复命令...\n下一步..." "type:task" "term:T1"`
   - 检查点：`gh tlog <id> "检查点 YYYY-MM-DD HH:mm\n已完成: ...\n阻塞: ...\n恢复命令: ...\n下一步: ..."`
   - 恢复：`gh tresume <id>`
   - 完成：`gh tdone <id> "完成说明: ..."`

4. **日志模式命令**
   - 先将上下文整理为：`背景 / 主题拆分 / 关键结论 / 后续动作`
   - 创建 issue（推荐标签：`type:log` + `status:done`）
   - 如未创建 `type:log`，先自动创建标签后再建日志

5. **输出规范（每次执行后）**
   - 必须返回：执行了什么、产出链接、下一步建议。
   - 如果是恢复操作，额外给出“最后一个检查点摘要”。

## 示例

- 输入：`帮我存档今天这段对话，按主题拆分并写结论`
  - 行为：创建一条日志 issue，并设置为完成状态。

- 输入：`给 12 号任务打检查点：已复现，下一步对比配置`
  - 行为：向 #12 追加标准检查点评论。

- 输入：`恢复 12`
  - 行为：读取 #12 评论并摘要最后一个检查点。

## 边界情况

- 用户未给 issue 编号却要求记录检查点：先列出 `status:in-progress` 让用户选择。
- 一个任务跨多个终端：保留一个主终端标签，细节写在检查点。
- 任务已关闭又继续：先 `gh issue reopen <id> -R qiao-925/qiao-925`，再切回 `status:in-progress`。
- 网络导致 `gh auth refresh` 失败：改用 PAT + `gh auth login --with-token`。

## 主动提醒机制（默认开启）

- 每次执行“记录检查点 / 存档日志 / 恢复任务”后，自动输出一段“可能遗漏提醒”。
- 提醒分级：
  - **必须做**：会影响当前环境可用性的动作（例如重启生效验证）
  - **建议做**：会影响上下文整洁性的动作（例如关闭演示任务）
  - **可稍后**：中长期优化项（例如是否升级到 Project）
- 识别规则（关键词触发）：`稍后` `回头` `重启` `待验证` `没空` `先不做` `网络问题` `权限`
- 若识别到“可执行但易遗忘”事项，自动创建 `type:reminder + status:todo` 的提醒 issue。

