# 规划工作流详细说明

## 1. 核心流程

```
任务启动 → 评估复杂度 → 创建计划书 → 创建/绑定 GitHub Issue → 按 CP 执行并调用 W00 记录 checkpoint → 更新状态 → 归档
```

## 2. 复杂度评估

| 复杂度 | 特征 | 处理方式 |
|--------|------|----------|
| 简单 | 1-2 步，单文件 | 直接执行，完成后生成任务日志 |
| 中等 | 3-5 步，2-3 文件 | 建议创建计划书 |
| 复杂 | >5 步，多文件/架构变更 | **必须**创建计划书 |

## 3. 计划书内容

### 3.1 必需章节

- [ ] Checkpoint 状态表
- [ ] 背景与目标
- [ ] 实施步骤（含验收标准）
- [ ] 文件改动清单

**文件改动清单格式**（硬性要求）：
- 每个拟新增/修改文件须写**一句话职责**与**行数预算（≤300）**。
- 各 CP 的「预计文件改动」须遵循上述格式（表格列：文件、职责、行数预算）。
- 参考：`file-size-limit`、`single-responsibility`。

### 3.2 可选章节

- 技术方案
- 风险与注意事项

## 4. Checkpoint 执行规范

### 4.1 CP 划分原则

- 每个 CP 应是 1-2 小时可完成的独立单元
- CP 之间应有明确的验收标准
- 复杂任务建议 3-8 个 CP

### 4.2 状态标记

| 标记 | 含义 |
|------|------|
| ⬜ | 待开始 |
| 🔄 | 进行中 |
| ✅ | 已完成 |
| ⏸️ | 暂停 |
| ❌ | 取消 |

### 4.3 执行要点

- 完成后立即更新状态表
- 遇到阻塞或变更，在计划书中记录
- 允许中途调整 CP 划分

**实施步骤中的「预计文件改动」**：每个 CP 的预计文件改动须按「文件、职责、行数预算（≤300）」列出，写代码前即约定模块边界。

## 5. 文件管理

### 5.1 存放位置

- 进行中：`agent-task-log/ongoing/`
- 完成后：移动到 `agent-task-log/archive/YYYY-MM/`

### 5.2 命名格式

```
YYYY-MM-DD-N_【plan】任务名称-实施计划.md
```

## 6. GitHub Issues（W00）联动

### 6.1 何时必须联动

- 任务预计跨会话或跨天执行
- 需要项目级查看进行中任务
- 需要记录下一步（Next）与阻塞状态

### 6.2 计划书最小字段

- `Issue #`：关联 issue 编号
- `status`：`status:todo / status:in-progress / status:blocked / status:done`
- `Next`：下一步动作

### 6.3 每个 CP 的联动动作

- 计划书状态更新（本地文档）
- issue checkpoint 更新（线上 issue 评论）
- 若阻塞：同步设置 `status:blocked` 并记录 blocker

### 6.4 触发方式

- 自动：主流程阶段在关键节点自动调用 `w00-workflow-checkpoint` 做存档/读档
- 手动：用户可随时调用 `/w00-workflow-checkpoint` 进行补记或读档

## 7. 工具脚本

### 7.1 生成计划书

**脚本**：`scripts/generate_task_plan.py`

**功能**：
- 从上下文提取任务信息
- 规划 Checkpoint（3-8 个独立阶段）
- 生成符合规范的计划书

**调用方式**：手动调用（用户主动触发）

**输出**：
- 计划书文件路径
- Checkpoint 状态表摘要
- 下一步行动建议
