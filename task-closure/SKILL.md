---
name: task-closure
description: 任务收尾规范，包含日志生成和优化分析。适用于主要交付完成后的收尾阶段。
---

# 任务收尾规范

> 适用于主要交付完成后的收尾阶段，确保日志、优化分析完整落地。

---

## ⚠️ 核心强制要求

### 触发条件

- 主要功能或文档交付已完成
- 用户明确指示"进入收尾/后置流程"
- Agent 交付总结后询问并获得同意

### 必须执行的流程

1. **结构检查（再收尾）**：本任务涉及的所有代码文件 ≤300 行（`file-size-limit`）、职责清晰且无循环依赖（`single-responsibility`）。若超限或职责不清：先拆分/重构再继续收尾；若用户选择暂不处理，在日志中记录「遗留：结构问题」及建议。
2. **生成任务日志**：使用 `scripts/generate_task_log.py`
3. **六维度优化分析**：代码质量/架构设计/性能/测试/可维护性/技术债务

---

## AI Agent 行为要求

### 主动询问

完成主要交付后，主动询问：
```
主要交付已完成。是否进入收尾流程？
```

### 完成汇报

收尾完成后汇报日志位置和分析要点。

---

## 禁止事项

- ❌ 跳过收尾流程或伪造执行结果
- ❌ 漏写日志核心字段、六维分析
- ❌ 未说明未执行项的原因与计划

---

## 工具脚本

**脚本**：`scripts/generate_task_log.py`

**功能**：生成符合规范的任务日志，包含六维度优化分析

---

## 参考资料

- `references/closure-workflow.md` - 收尾工作流详细说明（触发条件、结构检查、日志规范、六维度分析）
- `refactor-and-decompose/SKILL.md` - 收尾前结构检查约束
