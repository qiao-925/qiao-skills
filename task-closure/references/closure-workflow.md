# 收尾工作流详细说明

## 1. 触发条件

- 主要功能或文档交付已经完成，准备进入收尾阶段
- 用户明确指示"进入收尾/后置流程/收尾阶段"等
- Agent 在交付总结后询问是否进入收尾流程并获得同意

## 2. 执行流程

### 2.0 结构检查（再收尾）

**顺序**：先执行结构检查，通过后再执行 2.1、2.2。

**检查内容**：
- 本任务涉及的所有代码文件 ≤300 行（参考 `file-size-limit`）
- 每个文件职责清晰、无循环依赖（参考 `single-responsibility`）

**未通过时**：先拆分/重构再继续收尾；若用户选择暂不处理，在后续任务日志中记录「遗留：结构问题」及具体建议。

### 2.1 生成任务日志

**工具**：`scripts/generate_task_log.py`

**输出内容**：
- 元信息（任务类型、日期、相关文件）
- 关键步骤
- 实施说明
- 测试结果
- 交付结论
- 遗留问题或后续计划

### 2.2 六维度优化分析（结构检查通过后执行）

| 维度 | 评估内容 |
|------|----------|
| 代码质量 | 可读性、规范性、复杂度 |
| 架构设计 | 分层、依赖、扩展性 |
| 性能 | 响应时间、资源消耗 |
| 测试 | 覆盖率、边界用例 |
| 可维护性 | 文档、注释、模块化 |
| 技术债务 | 临时方案、已知问题 |

**分析要求**：
- 每个维度至少一项亮点（✅）
- 每个维度至少一项改进建议（⚠️）
- 改进建议含：影响、建议、优先级（🔴/🟡/🟢）

### 2.3 优先级汇总

| 优先级 | 含义 | 处理时间 |
|--------|------|----------|
| 🔴 | 立即处理 | 本周内 |
| 🟡 | 近期处理 | 本月内 |
| 🟢 | 长期规划 | 季度内 |

## 3. 日志规范

### 3.1 存放位置

- 新建：`agent-task-log/ongoing/`
- 完成后：移动到 `agent-task-log/archive/YYYY-MM/`

### 3.2 命名格式

```
YYYY-MM-DD-N_【task_type】任务名称-文档类型.md
```

### 3.3 标题格式

```
# YYYY-MM-DD 【task_type】任务名称-文档类型
```

`task_type` 取自 `TASK_TYPES.md`

## 4. 协作说明

### 4.1 Agent 主动触发

Agent 完成主要交付后，主动询问：
```
主要交付已完成。是否进入收尾流程？
- 生成任务日志
- 进行六维度优化分析
```

### 4.2 用户主动触发

用户声明"收尾/后置流程"时，Agent 立即执行并记录触发方式。

### 4.3 完成汇报

收尾完成后汇报：
- 日志位置
- 分析要点摘要

## 5. 延迟执行处理

若因故延迟执行：
1. 记录原因
2. 记录计划执行时间
3. 设置提醒补齐
