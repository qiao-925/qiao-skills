---
name: w05-task-closure
description: 任务收尾规范，包含日志生成和优化分析。适用于主要交付完成后的收尾阶段。
---

# 任务收尾规范

> 适用于主要交付完成后的收尾阶段，确保日志、优化分析完整落地。

---

## ⚠️ 核心强制要求

### 触发条件

- 主要功能或文档交付已完成
- 用户明确指示"进入收尾/后置流程"
- Agent 交付总结后询问并获得同意

### 必须执行的流程

1. **W00 同步检查**：确认已通过 `w00-workflow-checkpoint` 完成最终 issue 同步（含最终 checkpoint 摘要与下一步信息）。
2. **结构检查（再收尾）**：本任务涉及的所有代码文件 ≤300 行（`file-size-limit`）、职责清晰且无循环依赖（`single-responsibility`）。若超限或职责不清：先拆分/重构再继续收尾；若用户选择暂不处理，在日志中记录「遗留：结构问题」及建议。
3. **生成任务日志**：使用 `scripts/generate_task_log.py`
4. **六维度优化分析**：代码质量/架构设计/性能/测试/可维护性/技术债务

> 若未绑定 Issue，需在收尾说明中明确记录原因与补建计划，并补充项目级任务视图的替代追踪方式。

---

## AI Agent 行为要求

### 主动询问

完成主要交付后，主动询问：
```
主要交付已完成。是否进入收尾流程？
```

### 完成汇报

收尾完成后汇报日志位置和分析要点。

### 与 W00 协同（自动 + 手动）

- 收尾前检查是否存在绑定的 `Issue #`。
- 若存在：由 `w05-task-closure` 直接执行任务关闭；必要时仅调用 `w00-workflow-checkpoint` 补最后一次 checkpoint 存档。

---

## 禁止事项

- ❌ 跳过收尾流程或伪造执行结果
- ❌ 漏写日志核心字段、六维分析
- ❌ 未说明未执行项的原因与计划

---

## 工具脚本

**脚本**：`scripts/generate_task_log.py`

**功能**：生成符合规范的任务日志，包含六维度优化分析

---

## 参考资料

- `references/closure-workflow.md` - 收尾工作流详细说明（触发条件、结构检查、日志规范、六维度分析）
- `../w00-workflow-checkpoint/SKILL.md` - Workflow GitHub Issues 基础存档能力（自动 + 手动）
- `refactor-and-decompose/SKILL.md` - 收尾前结构检查约束
